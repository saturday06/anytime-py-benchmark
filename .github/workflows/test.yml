name: CodSpeed

on:
  push:

jobs:
  benchmarks:
    name: Run benchmarks
    runs-on: ubuntu-latest
    steps:
      - uses: actions/checkout@v4
      #- uses: actions/setup-python@v5
      #  with:
      #    python-version: '3.12' # ã”è‡ªèº«ã®Pythonãƒãƒ¼ã‚¸ãƒ§ãƒ³ã«åˆã‚ã›ã¦ãã ã•ã„

      # - name: Install dependencies
      #  run: |
      #    python -m pip install --upgrade pip
      #    pip install pytest pytest-codspeed
      #    # pip install -r requirements.txt ãªã©

      - run: |
          sudo DEBIAN_FRONTEND=noninteractive apt-get update -q
          sudo DEBIAN_FRONTEND=noninteractive apt-get install python3-full --no-install-recommends --yes
          python3 --version
          pip3 install pytest pytest-codspeed

      # ğŸ”½ ã“ã®ã‚¹ãƒ†ãƒƒãƒ—ã‚’ç¢ºèªãƒ»ä¿®æ­£ã—ã¦ãã ã•ã„ ğŸ”½
      - name: Run benchmarks
        uses: CodSpeedHQ/action@v4 # (ã¾ãŸã¯ @v3, @v2)
        with:
          # [å¿…é ˆ] ãƒ—ãƒ­ãƒ•ã‚¡ã‚¤ãƒªãƒ³ã‚°ã¨ãƒ•ãƒ¬ãƒ¼ãƒ ã‚°ãƒ©ãƒ•ç”Ÿæˆã«å¿…è¦ã§ã™
          mode: instrumentation 
          
          # [å¿…é ˆ] å®Ÿè¡Œã™ã‚‹ãƒ™ãƒ³ãƒãƒãƒ¼ã‚¯ã‚³ãƒãƒ³ãƒ‰
          run: pytest --codspeed 
          
          # (ã‚ªãƒ—ã‚·ãƒ§ãƒ³: pytest-xdist ã‚’ä½¿ã†å ´åˆ)
          # run: pytest --codspeed -n auto 
          
          # (ãƒ—ãƒ©ã‚¤ãƒ™ãƒ¼ãƒˆãƒªãƒã‚¸ãƒˆãƒªã®å ´åˆã«å¿…è¦)
          # token: ${{ secrets.CODSPEED_TOKEN }}
